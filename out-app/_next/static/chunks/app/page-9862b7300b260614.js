(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6710:function(e,t,r){Promise.resolve().then(r.bind(r,8212))},6463:function(e,t,r){"use strict";var s=r(1169);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},8212:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(7437),n=r(2265),a=r(6463),i=r(9733),o=r(7209),l=r(8185),c=r(4316),d=r(8473),u=r(6720),m=r(2686);function f(){let[e,t]=(0,n.useState)({name:"",phone:""}),[r,f]=(0,n.useState)(!1),[h,x]=(0,n.useState)(""),[g,p]=(0,n.useState)(""),[b,v]=(0,n.useState)(!0),y=(0,a.useRouter)(),N=(0,a.useSearchParams)();(0,n.useEffect)(()=>{(async()=>{let e=N.get("event_id");if(e){/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)||(d.k.error("Invalid event_id format:",e),x("URL中的活动ID格式无效")),p(e),v(!1);return}try{let{data:e,error:t}=await c.O.from("events").select("id").order("created_at",{ascending:!1}).limit(1);if(t){d.k.error("获取活动列表失败:",t),p(m.Yr),v(!1);return}e&&e.length>0?(p(e[0].id),d.k.log("✅ 自动获取最新活动ID:",e[0].id)):(p(m.Yr),d.k.log("⚠️ 没有找到活动，使用空UUID")),v(!1)}catch(e){d.k.error("获取活动ID失败:",e),p(m.Yr),v(!1)}})()},[N]);let j=e=>{let{name:r,value:s}=e.target;t(e=>({...e,[r]:s})),x("")},E=()=>e.name.trim()?e.phone.trim()?!!/^1[3-9]\d{9}$/.test(e.phone.trim())||(x("请输入正确的手机号"),!1):(x("请输入手机号"),!1):(x("请输入姓名"),!1),_=async t=>{if(t.preventDefault(),E()){f(!0),x("");try{let{data:t,error:r}=await c.O.from("attendees").select("*").eq("phone",e.phone.trim()).eq("event_id",g).maybeSingle();if(t){y.push("/ticket/".concat(t.id));return}let{data:s,error:n}=await c.O.from("attendees").insert({event_id:g,name:e.name.trim(),phone:e.phone.trim(),status:"registered"}).select().single();if(n)throw n;y.push("/ticket/".concat(s.id))}catch(e){d.k.error("Registration error:",e),(0,u.bh)(e,"PGRST116")?x("系统错误，请联系工作人员"):x("注册失败，请稍后重试")}finally{f(!1)}}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center px-4 py-8",children:(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"活动签到"}),(0,s.jsx)("p",{className:"text-gray-600",children:"请填写您的信息完成活动报名"})]}),(0,s.jsxs)(l.Zb,{className:"shadow-xl border-0",children:[(0,s.jsxs)(l.Ol,{className:"space-y-1 pb-4",children:[(0,s.jsx)(l.ll,{className:"text-lg text-center",children:"报名信息"}),(0,s.jsx)(l.SZ,{className:"text-center",children:"请确保信息准确，将用于现场核验"})]}),(0,s.jsxs)(l.aY,{children:[b&&(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"正在获取活动信息..."})]}),!b&&g&&g!==m.Yr&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-green-700",children:"✅ 已自动关联到当前活动"})}),!b&&(!g||g===m.Yr)&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"⚠️ 请在URL中添加活动ID，或创建活动后再报名"})}),!b&&g&&g!==m.Yr&&(0,s.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"姓名"}),(0,s.jsx)(o.I,{id:"name",name:"name",type:"text",placeholder:"请输入您的姓名",value:e.name,onChange:j,disabled:r,autoComplete:"name",className:"h-12"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"手机号"}),(0,s.jsx)(o.I,{id:"phone",name:"phone",type:"tel",placeholder:"请输入您的手机号",value:e.phone,onChange:j,disabled:r,autoComplete:"tel",className:"h-12"})]}),h&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3 flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"text-sm text-red-600",children:h})]}),(0,s.jsx)(i.z,{type:"submit",className:"w-full h-12 text-base font-medium shadow-lg",disabled:r||b,children:r||b?(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b?"加载活动信息...":"提交中..."]}):"提交报名"})]}),!b&&(!g||g===m.Yr)&&(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"没有可用的活动，请联系工作人员创建活动后再报名"})})]})]}),(0,s.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500 mb-20",children:(0,s.jsx)("p",{children:"提交后将生成您的专属电子凭证"})})]})})}function h(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center px-4 py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})}),children:(0,s.jsx)(f,{})})}},9733:function(e,t,r){"use strict";r.d(t,{z:function(){return i}});var s=r(7437),n=r(2265),a=r(231);let i=n.forwardRef((e,t)=>{let{className:r,variant:n="default",size:i="default",...o}=e;return(0,s.jsx)("button",{className:(0,a.cn)("inline-flex items-center justify-center rounded-xl text-sm font-medium transition-all active:scale-95","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50",{"bg-primary-600 text-white shadow-lg hover:bg-primary-700 focus-visible:ring-primary-500":"default"===n,"bg-gray-100 text-gray-900 hover:bg-gray-200 focus-visible:ring-gray-500":"secondary"===n,"border border-gray-200 bg-white text-gray-900 hover:bg-gray-50 focus-visible:ring-gray-500":"outline"===n,"text-gray-700 hover:bg-gray-100 focus-visible:ring-gray-500":"ghost"===n,"bg-red-600 text-white shadow-lg hover:bg-red-700 focus-visible:ring-red-500":"destructive"===n},{"h-12 px-6 py-3":"default"===i,"h-10 px-4 py-2":"sm"===i,"h-14 px-8 py-4 text-base":"lg"===i},r),ref:t,...o})});i.displayName="Button"},8185:function(e,t,r){"use strict";r.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},ll:function(){return l}});var s=r(7437),n=r(2265),a=r(231);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("rounded-xl border border-gray-200 bg-white text-gray-950 shadow-sm",r),...n})});i.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight",r),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-gray-500",r),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},7209:function(e,t,r){"use strict";r.d(t,{I:function(){return i}});var s=r(7437),n=r(2265),a=r(231);let i=n.forwardRef((e,t)=>{let{className:r,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-12 w-full rounded-xl border border-gray-200 bg-white px-4 py-3 text-sm","placeholder:text-gray-400","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...i})});i.displayName="Input"},231:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var s=r(4839),n=r(6164);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,s.W)(t))}},2686:function(e,t,r){"use strict";r.d(t,{MO:function(){return i},Pd:function(){return n},Pw:function(){return c},Uf:function(){return l},Yr:function(){return s},dn:function(){return a},o3:function(){return o}});let s="00000000-0000-0000-0000-000000000000",n={STAFF_AUTO_CONTINUE_SCAN:"staff_auto_continue_scan",STAFF_WAIT_TIME:"staff_wait_time",STAFF_SELECTED_EVENT_ID:"staff_selected_event_id",STAFF_SELECTED_EVENT_NAME:"staff_selected_event_name"},a={DEFAULT_WAIT_TIME:2,MIN_WAIT_TIME:1,MAX_WAIT_TIME:10,CAMERA_RETRY_DELAY:1e3,SCANNER_RESTART_DELAY:500},i={NOTIFICATION_DURATION:3e3,SCAN_RESULT_DELAY:2e3,ERROR_RETRY_DELAY:5e3,TOAST_AUTO_CLOSE_DELAY:5e3},o={REGISTERED:"registered",CHECKED_IN:"checked_in",REDEEMED:"redeemed"},l={FPS:10,QRBOX_WIDTH:250,QRBOX_HEIGHT:250,CAMERA_LABELS:{BACK:["back","environment","后置"],FRONT:["front","user","前置"]}},c={CHECK_IN_SUCCESS:"已成功入场",REDEEM_SUCCESS:"已完成核销",COPY_SUCCESS:"链接已复制到剪贴板",SAVE_SUCCESS:"保存成功",DELETE_SUCCESS:"删除成功"}},8473:function(e,t,r){"use strict";r.d(t,{k:function(){return n}});class s{formatMessage(e,t,r){let s=new Date().toISOString(),n=this.getEmoji(e);return"".concat(n," [").concat(s,"] ").concat(t)}getEmoji(e){switch(e){case"log":return"\uD83D\uDD0D";case"error":return"❌";case"warn":return"⚠️";case"debug":return"\uD83D\uDC1B";default:return"\uD83D\uDCDD"}}log(e,t){this.isDevelopment&&console.log(this.formatMessage("log",e,t),t||"")}error(e,t){console.error(this.formatMessage("error",e,t),t||"")}warn(e,t){this.isDevelopment&&console.warn(this.formatMessage("warn",e,t),t||"")}debug(e,t){this.isDevelopment&&console.debug(this.formatMessage("debug",e,t),t||"")}group(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isDevelopment&&(t?console.groupCollapsed("\uD83D\uDCC1 ".concat(e)):console.group("\uD83D\uDCC1 ".concat(e)))}groupEnd(){this.isDevelopment&&console.groupEnd()}time(e){this.isDevelopment&&console.time("⏱️ ".concat(e))}timeEnd(e){this.isDevelopment&&console.timeEnd("⏱️ ".concat(e))}table(e,t){this.isDevelopment&&console.table(e,t)}constructor(){this.isDevelopment=!1}}let n=new s},4316:function(e,t,r){"use strict";r.d(t,{O:function(){return i}});var s=r(2562);let n="https://lpbkoksinwcmoniamsvq.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwYmtva3NpbndjbW9uaWFtc3ZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NzAzNjEsImV4cCI6MjA4MDI0NjM2MX0.Be8NAJ8jdZtdl3cTwtsJbjphcePUf7gFHPbxEXjc1_Q";if(!n||!a)throw Error("Supabase URL and Anon Key are required. Please check your environment variables.");let i=(0,s.eI)(n,a)},6720:function(e,t,r){"use strict";function s(e){return e&&"object"==typeof e?{name:"name"in e?String(e.name):void 0,message:"message"in e?String(e.message):void 0,code:"code"in e&&("string"==typeof e.code||"number"==typeof e.code)?e.code:void 0,stack:"stack"in e?String(e.stack):void 0}:"string"==typeof e?{message:e}:{message:String(e)}}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"未知错误";return s(e).message||t}function a(e,t){return s(e).code===t}r.d(t,{bh:function(){return a},e$:function(){return n}})}},function(e){e.O(0,[868,562,971,23,744],function(){return e(e.s=6710)}),_N_E=e.O()}]);